<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><meta name="google-site-verification" content="GY3xi-El9ePp4mSskpCuCNS4x4elE7wbFPe2eKCtS8Y"><title>Day7 DataStructure about Map | Xinli's Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.2.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Day7 DataStructure about Map</h1><a id="logo" href="/.">Xinli's Blog</a><p class="description">Coding World</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Day7 DataStructure about Map</h1><div class="post-meta">Aug 15, 2016<span> | </span><span class="category"><a href="/categories/Data-Structure/">Data Structure</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-disqus-identifier="2016/08/15/Day7-DataStructure-about-Map/" href="/2016/08/15/Day7-DataStructure-about-Map/#disqus_thread" class="disqus-comment-count"></a><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">Contents</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#攻略模板"><span class="toc-number">1.</span> <span class="toc-text">攻略模板</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#自己回忆"><span class="toc-number">2.</span> <span class="toc-text">自己回忆</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实现数据结"><span class="toc-number">3.</span> <span class="toc-text">实现数据结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#学习后总结："><span class="toc-number">4.</span> <span class="toc-text">学习后总结：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#HashMap-vs-Hashtable"><span class="toc-number">4.1.</span> <span class="toc-text">HashMap vs. Hashtable</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ConcurrentHashMap-vs-Hashtable"><span class="toc-number">4.2.</span> <span class="toc-text">ConcurrentHashMap vs. Hashtable</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LinkedHashMap-vs-TreeMap"><span class="toc-number">4.3.</span> <span class="toc-text">LinkedHashMap vs. TreeMap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HashMap的方法"><span class="toc-number">4.4.</span> <span class="toc-text">HashMap的方法</span></a></li></ol></li></ol></div></div><div class="post-content"><p>本篇是关于Map的原理与应用.</p>
<h2 id="攻略模板"><a href="#攻略模板" class="headerlink" title="攻略模板"></a>攻略模板</h2><ul>
<li>回忆数据结构：分析数据结构特性，比较类似数据结构差异</li>
<li>实现数据结构</li>
<li>实战训练使用该数据结构</li>
<li>总结该数据结构特点，并总结算法题</li>
</ul>
<h2 id="自己回忆"><a href="#自己回忆" class="headerlink" title="自己回忆"></a>自己回忆</h2><ul>
<li>HashMap: key不能重复，value可以重复，只能存储wrapper class，not primitive type. Not thread-safe. It is faster than hashtable.    </li>
<li>Hashtable:  Thread-safe. Others are similar to HashMap.</li>
<li>ConcurrentHashMap: It’s thread-safe.</li>
<li>TreeMap: It’s ordered map.</li>
</ul>
<h2 id="实现数据结"><a href="#实现数据结" class="headerlink" title="实现数据结"></a>实现数据结</h2><p>HashMap works on the principal of hashing.<br>HashMap stores both <code>key+value</code> pair in every node of linked list.</p>
<ul>
<li>How do <code>get()</code> and <code>put()</code> method of HashMap work: As we put(key,value) to store key-value pairs into the hashmap, HashMap implementation calls <code>hashcode()</code> on Key object to calculate a hash that is used to find a bucket where entry(key and value) will be stored.  When <code>get()</code> method is used to retrieve value, again key objects is used to calculate the hash then to find the bucket where that particular key is stored.</li>
<li><code>Collision</code>: Two different keys with the same hash value.  </li>
<li>What will happen if two different objects have same hashcode: Since hashcode() is same, bucket location would be same and collision occurs in hashmap. Since HashMap uses a linked list to store in bucket, object(both key and value) will be stored in next node of linked list.</li>
<li>How did you retrieve if two different objects have same hashcode: After finding bucket location through the hashcode(via key), we will call <code>keys equals()</code> method to identify correct node in linked list and return the associated value object for that key. </li>
<li>How to reduce collision: Using immutable, final obejct with proper equals() and hashcode() implementation wolud act as perfect JAVA HashMap keys and improve performance.  Since immutablity also allows caching their hashcode of different keys which makes overall retrieval process very fast.</li>
<li>The performance of get() method when collision happen: Using equals() method to compare keys to find out the correct object within a linked-list. The complexity is <code>O(n)</code>.  If hash will change from using a linked list to a balanced tree. This will improve to <code>O(logn)</code>.</li>
</ul>
<p>特别注意：</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">HashMap&lt;Character, Integer&gt; <span class="built_in">map</span> = <span class="keyword">new</span> HashMap&lt;&gt;();</div><div class="line"><span class="built_in">map</span>.<span class="built_in">put</span>(<span class="string">'z'</span>,<span class="number">1</span>);</div><div class="line"><span class="built_in">map</span>.<span class="built_in">put</span>(<span class="string">'z'</span>,<span class="number">2</span>);</div><div class="line">System.out.<span class="built_in">println</span>(<span class="built_in">map</span>.<span class="built_in">get</span>(<span class="string">'z'</span>));</div><div class="line"></div><div class="line"><span class="comment">//This will output 2, because put() method, key is same then it will get the most recently value instead.</span></div></pre></td></tr></table></figure>
<h2 id="学习后总结："><a href="#学习后总结：" class="headerlink" title="学习后总结："></a>学习后总结：</h2><h3 id="HashMap-vs-Hashtable"><a href="#HashMap-vs-Hashtable" class="headerlink" title="HashMap vs. Hashtable"></a>HashMap vs. Hashtable</h3><ul>
<li>HashMap: It’s not synchronized so it’s faster and takes less memory than Hashtable.  It allows one null key and any number of null values. </li>
<li>Hashtable: It’s synchronized so it’s thread-safe. It doesn’t allow null keys or values. </li>
</ul>
<h3 id="ConcurrentHashMap-vs-Hashtable"><a href="#ConcurrentHashMap-vs-Hashtable" class="headerlink" title="ConcurrentHashMap vs. Hashtable"></a>ConcurrentHashMap vs. Hashtable</h3><ul>
<li>ConcurrentHashMap provides its own synchronization, so you don’t have to  synchronize access to it explicitly. It provides <code>putIfAbsent</code> method and this ensure to atomically add a mapping if the specific key does’t exist.</li>
</ul>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">ConcurrentHashMap&lt;<span class="built_in">String</span>, Integer&gt; myMap = new ConcurrentHashMap&lt;<span class="built_in">String</span>, Integer&gt;()<span class="comment">;</span></div><div class="line"></div><div class="line">//this is <span class="literal">not</span> thread-safe, because another thread may add a mapping <span class="keyword">for</span> <span class="string">'key'</span> between the <span class="built_in">call</span> <span class="keyword">to</span> containsKey() <span class="literal">and</span> the <span class="built_in">call</span> <span class="keyword">to</span> put()<span class="comment">;</span></div><div class="line"><span class="keyword">if</span>(maMap.containsKey(<span class="string">"key"</span>)) &#123;</div><div class="line">	myMap.put(<span class="string">"key"</span>,<span class="number">1</span>)<span class="comment">;</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">//this is thread-safe</div><div class="line">myMap.putIfAbsent(<span class="string">"key"</span>,<span class="number">1</span>)<span class="comment">;</span></div></pre></td></tr></table></figure>
<ul>
<li>The difference between ConcurrentHashMap and Hashtable:        </li>
</ul>
<p>ConcurrentHashMap uses a <code>lock striping strategy</code>: It uses mutiple locks  on segment level instead of object level. It has(with defalut setting) 16 locks, each guarding 1/16th of the hashmap buckets. In this way, multiple threads can get/put key-value pairs from ConcurrentHashMap without blocking/waiting for each other.  (just like it locks each room instead of main door)<br>Hashtable and Collections.synchronizedMap(): It uses single lock for entire map.   It means if multiple threads try to access to it at the same time, it only allows one thread to access to it.  (it locks home’s main door)         </p>
<ul>
<li>How to make HashMap thread safe: You can make HashMap thread safe by wrapping it with Collections.synchronizedMap(). Or use <code>lock</code> explicitly. </li>
</ul>
<table>
<thead>
<tr>
<th>Property</th>
<th>HashMap</th>
<th>Hashtable</th>
<th>ConcurrentHashMap</th>
</tr>
</thead>
<tbody>
<tr>
<td>Null values/keys</td>
<td>One null key, any number of null values</td>
<td>not allowed</td>
<td>not allowed</td>
</tr>
<tr>
<td>Is thread-safe</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>Lock mechanism</td>
<td>not applicable</td>
<td>locks entire map(locks the object)</td>
<td>locks the portion of map(locks the bucket)</td>
</tr>
<tr>
<td>Iterator</td>
<td>fail-fast</td>
<td>fail-fast</td>
<td>fail-safe</td>
</tr>
</tbody>
</table>
<h3 id="LinkedHashMap-vs-TreeMap"><a href="#LinkedHashMap-vs-TreeMap" class="headerlink" title="LinkedHashMap vs. TreeMap"></a>LinkedHashMap vs. TreeMap</h3><ul>
<li>TreeMap: It’s a tree based mapping. Its put/get operations take O(log n) time. It requires items to have some comparison mechanism, either with Comparable or Comparator.  The iteration order is determined by this mechanism(so the default ordering is natural ordering).</li>
<li>LinkedHashMap: It’s based on HashMap and Linked List, but it adds awareness to the order at which items are added.  So the iteration order is the same as insertion order.</li>
</ul>
<table>
<thead>
<tr>
<th>Property</th>
<th>HashMap</th>
<th>LinkedHashMap</th>
<th>TreeMap</th>
</tr>
</thead>
<tbody>
<tr>
<td>Order</td>
<td>no guarantee order</td>
<td>insertion order</td>
<td>sorted according comparison mechanism(the default is natural ordering)</td>
</tr>
<tr>
<td>Get/put/remove/containsKey</td>
<td>O(1)</td>
<td>O(1)</td>
<td>O(logn)</td>
</tr>
<tr>
<td>Interfaces</td>
<td>Map</td>
<td>Map</td>
<td>Map,NavigableMap,SortedMap</td>
</tr>
<tr>
<td>Null values/keys</td>
<td>allowed</td>
<td>allowed</td>
<td>only values</td>
</tr>
<tr>
<td>Fail-fast behavior</td>
<td>Will throw ConcurrentModificationException</td>
<td>Will throw ConcurrentModificationException</td>
<td>Will throw ConcurrentModificationException</td>
</tr>
<tr>
<td>Implementation</td>
<td>buckets</td>
<td>doble-linked bukets</td>
<td>Red-Black Tree</td>
</tr>
<tr>
<td>Is sunchronized</td>
<td>No</td>
<td>No</td>
<td>No</td>
</tr>
</tbody>
</table>
<h3 id="HashMap的方法"><a href="#HashMap的方法" class="headerlink" title="HashMap的方法"></a>HashMap的方法</h3><ul>
<li>values() 返回所有值（value）的集合，是一个Collection</li>
<li>keySet() 返回所有键（key）的集合，是一个set集合，遍历这个set，用get()获取key所对应的value，也就遍历了Map</li>
<li>entrySet() 返回一个Set集合，在set集合中存放的是Map.Entry类型的对象，每个Entry代表Map的one pair(key,value)</li>
</ul>
<p>遍历HashMap的两种方法：</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">Map</span>&lt;<span class="keyword">String,String&gt; </span><span class="meta">map</span> = new HashMap&lt;&gt;()<span class="comment">;</span></div><div class="line">//遍历方法<span class="number">1</span>：keySet() <span class="meta">include</span> all keys</div><div class="line"><span class="keyword">Iterator&lt;String&gt; </span><span class="keyword">iterator </span>= <span class="meta">map</span>.keySet().<span class="keyword">iterator();</span></div><div class="line"><span class="symbol">while</span>(<span class="keyword">iterator.hasNext()) </span>&#123;</div><div class="line">	<span class="keyword">String </span>key = <span class="keyword">iterator.next();</span></div><div class="line">	<span class="keyword">String </span>value = <span class="meta">map</span>.get(key)<span class="comment">;</span></div><div class="line">&#125;</div><div class="line">//遍历方法<span class="number">2</span>：返回此映射中包含的映射关系的Set视图</div><div class="line"><span class="keyword">Iterator&lt;Map.Entry&lt;String,String&gt;&gt; </span><span class="keyword">iterator </span>= <span class="meta">map</span>.entrySet().<span class="keyword">iterator();</span></div><div class="line"><span class="symbol">while</span>(<span class="keyword">iterator.hasNext()) </span>&#123;</div><div class="line">	<span class="meta">Map</span>.Entry <span class="meta">entry</span> = <span class="keyword">iterator.next();</span></div><div class="line">	<span class="keyword">String </span>key = <span class="meta">entry</span>.getKey()<span class="comment">;</span></div><div class="line">	<span class="keyword">String </span>value = <span class="meta">entry</span>.getValue()<span class="comment">;</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://xinli90.com/2016/08/15/Day7-DataStructure-about-Map/" data-id="ciuojavha0038tngi2h7fx6hq" class="article-share-link">Share</a><div class="tags"><a href="/tags/Seeking-Job/">Seeking Job</a></div><div class="post-nav"><a href="/2016/08/16/Day8-DataStructure-about-Set/" class="pre">Day8 DataStructure about Set</a><a href="/2016/08/13/Implement-Stack-using-Queues/" class="next">Implement Stack using Queues</a></div><div id="disqus_thread"><script>var disqus_shortname = 'xinli';
var disqus_identifier = '2016/08/15/Day7-DataStructure-about-Map/';
var disqus_title = 'Day7 DataStructure about Map';
var disqus_url = 'http://xinli90.com/2016/08/15/Day7-DataStructure-about-Map/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//xinli.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://xinli90.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/Leetcode/" style="font-size: 15px;">Leetcode</a> <a href="/tags/Seeking-Job/" style="font-size: 15px;">Seeking Job</a> <a href="/tags/J2EE/" style="font-size: 15px;">J2EE</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/iOS/" style="font-size: 15px;">iOS</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/AWS/">AWS</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Algorithm/">Algorithm</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Data-Structure/">Data Structure</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Database/">Database</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Design-Pattern/">Design Pattern</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Geek/">Geek</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/HTTP/">HTTP</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/J2EE/">J2EE</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JAVA/">JAVA</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Leetcode/">Leetcode</a><span class="category-list-count">99</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Multithreading/">Multithreading</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/class-design/">class design</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/">iOS</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/10/24/Evaluate-Reverse-Polish-Notation/">Evaluate Reverse Polish Notation</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/24/Best-Time-to-Buy-and-Sell-Stock-with-Cooldown/">Best Time to Buy and Sell Stock with Cooldown</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/23/Best-Time-to-Buy-and-Sell-Stock-IV/">Best Time to Buy and Sell Stock IV</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/23/Best-Time-to-Buy-and-Sell-Stock-III/">Best Time to Buy and Sell Stock III</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/21/Best-Time-to-Buy-and-Sell-Stock-II/">Best Time to Buy and Sell Stock II</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/21/Best-Time-to-Buy-and-Sell-Stock/">Best Time to Buy and Sell Stock</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/20/Search-in-Rotated-Sorted-Array/">Search in Rotated Sorted Array</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/20/Find-Minimum-in-Rotated-Sorted-Array/">Find Minimum in Rotated Sorted Array</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/19/Rotate-Array/">Rotate Array</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/19/Remove-Element/">Remove Element</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> Recent Comments</i></div><script type="text/javascript" src="//xinli.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Blogroll</i></div><ul></ul><a href="null" title="null" target="_blank"></a><ul></ul><a href="null" title="null" target="_blank"></a><ul></ul><a href="null" title="null" target="_blank"></a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">Xinli's Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-83440669-1','auto');ga('send','pageview');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>